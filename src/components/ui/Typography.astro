---
/*
 * Typography
 *
 * Used to render a single text element. If you need to render a lot of text,
 * wrap it with the Prose component instead.
 *
 * Note: the ".typography-prose" styles use the :where() selector to avoid adding
 * specificity to the styling. This allows other components to easily override
 * the prose styling if they wish.
 */
import type { JSX } from "astro/jsx-runtime";
import clsx from "clsx";

export type HeaderVariant = "h1" | "h2" | "h3" | "h4" | "h5" | "h6";
// for some reason prettier will mess up the build here
// prettier-ignore
export type BlockVariant = "p" | "p2" | "ol" | "ul" | "li" | "table" | "blockquote" | "cite";
export type ChildlessVariant = "hr";

interface ContainerProps {
  variant: HeaderVariant | BlockVariant | "prose";
  children: unknown;
  className?: string;
}
interface ChildlessProps {
  variant: ChildlessVariant;
  className?: string;
}
type Props = ContainerProps | ChildlessProps;

interface VariantElementMap {
  tag: keyof JSX.DefinedIntrinsicElements;
  className?: string;
}

/**
 * If any variants need to change the HTML element they render, add the mapping
 * to this object.
 */
const variantElements: { [key: string]: VariantElementMap } = {
  prose: {
    tag: "div",
    className: "typography-prose",
  },
  p2: {
    tag: "p",
    className: "p2",
  },
  callout: {
    tag: "div",
    className: "callout",
  },
};

const isChildless = (
  variant: Props["variant"],
): variant is ChildlessProps["variant"] => {
  return variant === "hr";
};

const { variant, className } = Astro.props;
const Element = variantElements[variant]?.tag ?? variant;
const classNames = clsx(variantElements[variant]?.className, className);
---

{
  isChildless(variant) ? (
    <Element class={classNames} />
  ) : (
    <Element class={classNames}>
      <slot />
    </Element>
  )
}
<style>
  @layer base {
    /*
     * Block-level elements
     */
    :where(p, ol, ul, blockquote),
    .callout,
    :global(p:where(.typography-prose p)),
    :global(ol:where(.typography-prose ol)),
    :global(ul:where(.typography-prose ul)),
    :global(blockquote:where(.typography-prose blockquote)),
    :global(div:where(.typography-prose .callout)) {
      margin-top: 0;
      margin-bottom: 1em;
      font-size: var(--font-size-primary);
    }

    .p2,
    :global(p:where(.typography-prose p.p2)) {
      font-size: var(--font-size-secondary);
    }

    :where(ol, ul),
    :global(ol:where(.typography-prose ol)),
    :global(ul:where(.typography-prose ul)) {
      padding-left: 2em;
    }

    :where(ol),
    :global(ol:where(.typography-prose ol)) {
      list-style-type: decimal;
    }

    :where(ul),
    :global(ul:where(.typography-prose ul)) {
      list-style-type: disc;
    }

    :where(li + li),
    :global(li:where(.typography-prose li + li)) {
      margin-top: 1em;
    }

    :where(blockquote),
    :global(blockquote:where(.typography-prose blockquote)) {
      padding: 1em;
      color: var(--color-text-secondary);
      background-color: var(--color-bg-light-second);
      font-style: italic;
    }

    :where(cite),
    :global(cite:where(.typography-prose cite)) {
      display: block;
      font-style: normal;
      margin-top: var(--spacing-sm);
    }

    :where(cite):before,
    :global(cite:where(.typography-prose cite)):before {
      content: "â€” ";
    }

    /*
     * Headings
     * Note: font-size, font-weight, and line-height are now defined in tailwind.css @layer base
     * Here we only add prose-specific margins
     */
    :where(h1, h2, h3, h4, h5, h6),
    :global(h1:where(.typography-prose h1)),
    :global(h2:where(.typography-prose h2)),
    :global(h3:where(.typography-prose h3)),
    :global(h4:where(.typography-prose h4)),
    :global(h5:where(.typography-prose h5)),
    :global(h6:where(.typography-prose h6)) {
      margin-top: var(--spacing-lg);
      margin-bottom: 0.5em;
    }

    /*
     * Table
     */
    :where(table),
    :global(table:where(.typography-prose table)) {
      width: 100%;
      font-size: var(--font-size-primary);
    }

    :where(table) :global(th),
    :global(th:where(.typography-prose table th)) {
      text-align: left;
    }

    :where(table) :global(th),
    :where(table) :global(td),
    :global(th:where(.typography-prose table th)),
    :global(th:where(.typography-prose table td)) {
      padding: var(--spacing-xs);
    }

    /*
     * Other elements
     */
    :where(hr),
    :global(hr:where(.typography-prose hr)) {
      margin: var(--spacing-lg) 0;
      border: none;
      height: 1px;
      background: var(--color-border);
    }

    /*
     * Callouts
     */
    .callout,
    :global(div:where(.typography-prose .callout)) {
      background-color: var(--color-bg-light);
      border: 1px solid var(--color-border);
      border-radius: 0.125rem;
      padding: 1em;
    }

    .callout-note,
    .callout-info,
    :global(div:where(.typography-prose .callout-note)),
    :global(div:where(.typography-prose .callout-info)) {
      background-color: #f3fdff;
      border-color: var(--color-info);
    }

    .callout:before,
    :global(div:where(.typography-prose .callout):before) {
      font-weight: var(--font-weight-bold);
      font-size: var(--font-size-secondary);
      display: block;
      margin-bottom: var(--spacing-sm);
      text-transform: uppercase;
    }

    .callout-info:before,
    .callout-note:before,
    :global(div:where(.typography-prose .callout-info):before),
    :global(div:where(.typography-prose .callout-note):before) {
      color: var(--color-info);
    }

    .callout-info:before,
    :global(div:where(.typography-prose .callout-info):before) {
      content: "Info";
    }

    .callout-note:before,
    :global(div:where(.typography-prose .callout-note):before) {
      content: "Note";
    }

    .callout-warning,
    :global(div:where(.typography-prose .callout-warning)) {
      border-color: var(--color-warning);
      background-color: #fff6d0;
    }

    .callout-warning:before,
    :global(div:where(.typography-prose .callout-warning):before) {
      content: "Warning";
      color: #bd9700;
    }

    .callout-danger,
    :global(div:where(.typography-prose .callout-danger)) {
      border-color: var(--color-danger);
      background-color: #ffd8d8;
    }

    .callout-danger:before,
    :global(div:where(.typography-prose .callout-danger):before) {
      content: "Danger";
      color: var(--color-danger);
    }

    /*
     * Prose
     */
    :global(code:where(.typography-prose code)),
    :global(kbd:where(.typography-prose kbd)),
    :global(samp:where(.typography-prose samp)),
    :global(pre:where(.typography-prose pre)) {
      font-family: var(--font-family-code);
      font-size: var(--font-size-code);
    }
    :global(code:where(.typography-prose :not(.astro-code) > code)) {
      color: var(--color-code);
    }

    :where(blockquote) > :first-child,
    .callout > :first-child,
    :global(blockquote:where(.typography-prose blockquote) > :first-child),
    :global(div:where(.typography-prose .callout) > :first-child),
    .typography-prose > :global(:first-child) {
      margin-top: 0;
    }

    :where(blockquote) > :last-child,
    .callout > :last-child,
    :global(blockquote:where(.typography-prose blockquote) > :last-child),
    :global(div:where(.typography-prose .callout) > :last-child),
    .typography-prose > :global(:last-child) {
      margin-bottom: 0;
    }
  }
</style>
