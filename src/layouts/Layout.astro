---
import type { ComponentProps } from "astro/types";
import { site } from "@config/site";
import { localizedHTML as favicons } from "astro-favicons/middleware";
import { config } from "virtual:config";
import { PageLayout } from "astro-orbit/components";
import GoogleAnalytics from "../components/GoogleAnalytics.astro";
import { Header } from "../components/Header";
import Footer from "../components/Footer.astro";
import "@fontsource/source-sans-pro/400.css";
import "@fontsource/source-sans-pro/600.css";
import "@fontsource-variable/source-code-pro";
import "@pagefind/default-ui/css/ui.css";
import "./theme.css";

type PageLayoutProps = ComponentProps<typeof PageLayout>;

interface Props {
  title?: PageLayoutProps["title"];
  description?: PageLayoutProps["description"];
  image?: PageLayoutProps["image"];
}

const { title, description, image } = Astro.props;

const pageTitle = title ? `${title} | ${config.title}` : config.title;
---

<PageLayout title={pageTitle} description={description} image={image}>
  <Fragment name="head-first">
    {
      !import.meta.env.DEV && (
        <>
          <GoogleAnalytics id={site.googleAnalyticsId} />
          {/* @ts-expect-error -- the "key" attribute is technically not valid */}
          <script
            is:inline
            key="plausible-script"
            defer
            data-domain="delta.io"
            src="https://plausible.io/js/script.js"
          />
        </>
      )
    }
  </Fragment>
  <Fragment name="head-last">
    <Fragment set:html={favicons(Astro.currentLocale)} />
  </Fragment>
  <Fragment name="body-first">
    <Header />
  </Fragment>
  <slot />
  <Fragment name="body-last">
    <Footer />
  </Fragment>
</PageLayout>
